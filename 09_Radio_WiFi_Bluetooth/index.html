<!DOCTYPE html>
<html lang="en">
<head>
  <title>PHYSCI 70: Intro to Digital Fabrication </title>
  <meta charset="utf-8">
  <link href="../style.css" rel="stylesheet">
</head>

<body style="padding-top: 60px;">
<xmp theme="journal" style="display:none;">


<div class="container-fluid">

  ### Week 9: Radio, WiFi, Bluetooth (IoT)

 ## For another week that incorporates Wifi documentation, check out my work on week 11, which mentions both the Wifi component and also the html display component! :) 

 ## Assignment
 Demonstrate communication between a microcontroller and another device. Optionally, work with a partner to control a device remotely.

  #Background on Project
Part of my final project includes communication between my microcontroller and another device. In essence, I want to have my temperature and my gas sensor to be the input and 
Thus, this week, I am trying to see if I could have my ESP32 act as an access point! 

What is an access point? Well, this picture from Random nerd tutorials sums it up pretty well. Essentially, when the ESP32 serves as an accesspoint, it looks something like the following: 
![accesspoint_2](./accesspoint_2.png)

The way Randomnerdtutorials describes it is "In simple words, when you set the ESP32 as an access point you create its own Wi-Fi network and nearby Wi-Fi devices (stations) can connect to it (like your smartphone or your computer)."

This in contrast to when a router instead acts as an access point. 
 ![accesspoint_1](./accesspoint_1.png)

The premise of my final project is that people can check in on if their compost is ready based on a couple of factors like temperature and methane levels. Hence, it makes sense to have ESP32 act as an access point, because since the toilet can be in more rural areas, there might not necessarily be a router nearby.


# Thermosister and Gas sensor

I first ran the codes for the thermosister and the gas sensor separately to make sure it was working. I decided to do this before trying to integrate the accesspoint feature. 
For some reason, although I've previously worked with the following temperature code, it just wouldn't work this time. I tried the files I worked with and adapted previously by swapping out different variable names and ensuring the Farenheit temperature was being printed out. I also went to the source and tried using the original code. However, I kept on getting negative temperatures and other malfunctions. 

Code adapted from (https://create.arduino.cc/projecthub/Marcazzan_M/how-easy-is-it-to-use-a-thermistor-e39321) that didn't work this time: 


<pre><code>

//Thermometer with thermistor

/*thermistor parameters:
 * RTI: 10 000 Ω
 * B: 3977 K +- 0.75%
 * TI:  25 C
 * +- 5%
 */

//These values are in the datasheet
#define RTI 10000   // Ω
#define B 3977      // K
//--------------------------------------


#define VCC 3.3    //Supply voltage
#define R 10000  //R=10KΩ

//Variables
float RT, VR, ln, TE, TI, VRT;

void setup() {
  Serial.begin(9600);
  TI = 25 + 273.15;                 //Temperature TI from datasheet, conversion from Celsius to kelvin
}

void loop() {
  VRT = analogRead(A0);              //Acquisition analog value of VRT
  Serial.println(VRT);
  VRT = (3.30 / 1023.00) * VRT;      //Conversion to voltage
  VR = VCC - VRT;
  RT = VRT / (VR / R);               //Resistance of RT
  Serial.println("RT/RTI");
  Serial.println(RT/RTI);

  ln = log(RT / RTI);
  Serial.println("Ln");
  Serial.println(ln);
  TE = (1 / ((ln / B) + (1 / TI))); //Temperature from thermistor

  TE = TE - 273.15 -11;                 //Conversion to Celsius

  // Serial.print("Temperature:");
  // Serial.print("\t");

  
  Serial.print(TE);
  Serial.print("C\t\t");
  
  Serial.print(TE + 273.15);        //Conversion to Kelvin
  Serial.print("K\t\t");
  
  Serial.print((TE * 1.8) + 32);    //Conversion to Fahrenheit
  Serial.print((TE * 1.8) + 32);
  Serial.println("F\t\t");

  
  delay(500);

 // if TE > 26
  //else 

}

</code></pre>  

Hence, I decided to run Rob Hart's temperature code instead, and this went well. 
Code from Rob Hart: 
<pre><code>
/*
Thermistor_read.  Robert Hart June 2020.
Using  datasheet for 10k NTC thermistor (Digikey Part No.).  https://www.vishay.com/docs/29049/ntcle100.pdf
with constants A and B to calculate Temperature from Resistance.
10K resitor in series to make a simple voltage divider.
*/
int ThermistorPin = A0;
int Vo;
float R1 = 10000;
float R2, T;
float A = 3.354e-03;
float B = 2.5698e-4;

void setup() {
Serial.begin(9600);
analogReadResolution(12);                 //Using a 32-bit ATSAM microcontroller that has up to 12 bit resolution. 4095 max.
}

void loop() {

  Vo = analogRead(ThermistorPin);
  R2 = R1 * 1/(4096.0 / (float)Vo - 1.0);         //Calculate resistance of thermistor from voltage divider math.
  T = (1.0 / (A + B*log(R2/R1) ));                 // Calculate temperature using datasheet formula.
  T = T - 273.15;                                   //Convert from Kelvin to Celcius.
 

  Serial.print("Temperature: "); 
  Serial.print(T);
  Serial.println("C"); 

  delay(500);
}  
</code></pre>  

Here is the temperature that displayed on the Serial monitor:
 ![rob_hart_temp_code_serial_monitor](./rob_hart_temp_code_serial_monitor.png)




There are lots of different types of gas sensors. I decided to use a MQ-4 because that detects methane, which is a byproduct of compost. 
![gas](./gas_sensor.png)





# Integrating the different codes 
Now, essentially, I have three pieces. I have the temperature sensing code. I have the gas sensing code. And lastly, I have the sample code on the Random Nerd Tutorials Website (https://randomnerdtutorials.com/esp32-access-point-ap-web-server/) that essentially tells you if your LED light is on or off. 

The Serial Monitor told me that the IP address was http://192.168.4.1/. Hence, when I connect to ESP32-Access-Point and go to the website. I am able to see this interface: 






#Reflections

This was honestly so cool. I didn't even know accesspoint was a thing. 

Although it wasn't a focus in this documentation, I also got to play around with the ESP32 Cam in class and lab, which was loads of fun. The Huzzah Cam had surprisingly good quality and had a similar setup idea where the serial monitor informs the address to go to. Here is more information about the ESP32 Cam: https://nathanmelenbrink.github.io/ps70/10_networking/setup.html! 


</xmp>
</body>

<script src="https://strapdownjs.com/v/0.2/strapdown.js"></script>
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" ></script> -->

</html>